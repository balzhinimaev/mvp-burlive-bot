# –ë—É—Ä—è—Ç—Å–∫–∏–π —è–∑—ã–∫ - Telegram Bot

–ü—Ä–æ—Å—Ç–æ–π Telegram –±–æ—Ç –Ω–∞ –≤–µ–±—Ö—É–∫–∞—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Mini App. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Mini App, —Å–±–æ—Ä UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞–∫ –ª–∏–¥–æ–≤ –∏ –±—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ Mini App.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ `/start` –∏ `/help`
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ deep-link payload
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–æ–≤ –Ω–∞ –±—ç–∫–µ–Ω–¥ API (`POST /api/v2/leads/bot_start`)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ startapp —Å—Å—ã–ª–æ–∫ –¥–ª—è Mini App —Å –ø–µ—Ä–µ–¥–∞—á–µ–π UTM
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ startapp deep links, —Ç–∞–∫ –∏ WebApp –∫–Ω–æ–ø–æ–∫
- ‚úÖ Webhook –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Telegram –∫–∞–Ω–∞–ª
- ‚úÖ Comprehensive logging –∏ error handling

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Node.js** —Å TypeScript
- **Telegraf** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram –±–æ—Ç–æ–≤
- **Axios** - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- **dotenv** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```env
# Telegram Bot Configuration
BOT_TOKEN=your_bot_token_here
BOT_USERNAME=your_bot_username_here

# API Configuration
API_BASE_URL=https://burlive.ru/api/v2

# Mini App Configuration
MINI_APP_STARTAPP_ENABLED=true
MINI_APP_URL=https://your-mini-app-domain.com

# Server Configuration
PORT=3000
WEBHOOK_PATH=/webhook

# Production only: Webhook URL for production deployment
# WEBHOOK_URL=https://your-bot-domain.com

# Logging Configuration
LOG_LEVEL=info

# Channel Logging Configuration
LOG_CHANNEL_ENABLED=true
LOG_CHANNEL_ID=-1001234567890

# Optional: Error Tracking
# SENTRY_DSN=your_sentry_dsn_here
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm run build && npm start
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Deep Link —Ñ–æ—Ä–º–∞—Ç

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ payload:

```
t.me/your_bot?start=us=vk&uc=launch&promo=BURI79
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `us`, `utm_source` - –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞
- `um`, `utm_medium` - –º–µ–¥–∏—É–º  
- `uc`, `utm_campaign` - –∫–∞–º–ø–∞–Ω–∏—è
- `ut`, `utm_term` - –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
- `ucn`, `utm_content` - —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- `promo`, `promo_id` - –ø—Ä–æ–º–æ–∫–æ–¥

### API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏–¥—ã –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç:

```
POST /api/v2/leads/bot_start
```

–° —Ç–µ–ª–æ–º –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "userId": 12345,
  "utm": {
    "utm_source": "vk", 
    "utm_campaign": "launch"
  },
  "promoId": "BURI79"
}
```

### Mini App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Mini App:

**–í–∞—Ä–∏–∞–Ω—Ç A (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ):** startapp deep link
```
https://t.me/bot?startapp=us%3Dvk%26uc%3Dlaunch
```

**–í–∞—Ä–∏–∞–Ω—Ç B:** WebApp –∫–Ω–æ–ø–∫–∞ —Å –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–æ–π

## –ö–æ–º–∞–Ω–¥—ã

- `/start [payload]` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –∫–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ Mini App
- `/help` - –°–ø—Ä–∞–≤–∫–∞ + –∫–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ Mini App

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ index.ts          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
‚îú‚îÄ‚îÄ config.ts         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ api.ts            # API —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∏–¥–æ–≤  
‚îú‚îÄ‚îÄ utils.ts          # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ UTM –∏ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
‚îú‚îÄ‚îÄ types.ts          # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ channel-logger.ts # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram –∫–∞–Ω–∞–ª
‚îî‚îÄ‚îÄ telegraf.d.ts     # –î–µ–∫–ª–∞—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –¥–ª—è telegraf
```

## Deployment

### Development
```bash
npm run dev  # Long polling
```

### Production
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions –ø—Ä–∏ push –≤ `main` –≤–µ—Ç–∫—É.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:
- –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü–∞—Ä—Å–∏–Ω–≥ UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- API –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
- –û—à–∏–±–∫–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `LOG_LEVEL`.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram –∫–∞–Ω–∞–ª

–ë–æ—Ç –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–∞–∂–∞—Ç–∏—è –∫–æ–º–∞–Ω–¥—ã `/start` –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π Telegram –∫–∞–Ω–∞–ª –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–∞ –ª–æ–≥–æ–≤

1. **–°–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª** –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
2. **–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª** –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
3. **–ü–æ–ª—É—á–∏—Ç–µ Chat ID –∫–∞–Ω–∞–ª–∞:**
   - –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@channel_username`
   - –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–∏—Å–ª–æ–≤–æ–π ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, `-1001234567890`)
4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```env
   LOG_CHANNEL_ENABLED=true
   LOG_CHANNEL_ID=-1001234567890  # –∏–ª–∏ @your_channel_username
   ```

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–∞–∂–∞—Ç–∏–∏ `/start` –≤ –∫–∞–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å:
- üÜï/üîÑ –°—Ç–∞—Ç—É—Å (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫)
- üë§ –ò–º—è –∏ username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üÜî User ID
- üìä UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (source, campaign, medium, etc.)
- üé´ –ü—Ä–æ–º–æ–∫–æ–¥ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- üïí –í—Ä–µ–º—è –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏—è

```
üÜï –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤ (@ivan_user)
üÜî ID: 123456789
üìä UTM: source: vk, campaign: launch
üé´ –ü—Ä–æ–º–æ: BURI79
üïí –í—Ä–µ–º—è: 03.09.2025, 15:30 (–ú–°–ö)
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ù–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π (–¥–æ—Å—Ç—É–ø/–ø–ª–∞—Ç–µ–∂–∏)
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã API –∑–∞–ø—Ä–æ—Å–æ–≤ (3 —Å–µ–∫)
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UX –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC
